# Koromo Copy 개발자 문서

## 목표

Emacs와 같이 다재 다능한 유틸리티를 만드는 것을 목표로하고 있습니다. 첫 번째 릴리즈가 끝나면 플러그인 기능을 개발할 계획입니다.

## Commit Prefix

`Koromo Copy`의 커밋은 다음 리스트 중 하나의 `Prefix`를 가집니다. 이 리스트는 삭제는 되지 않으나, 추가될 수 있습니다. 또한 여기에 없는 `Prefix`는 `hitomi`, `exh`와 같이 직관적으로 이해할 수 있는 범주들이라 보면됩니다.

```
kc: 이하 해당하지 않는 모든 커밋
tidy: 파일이동, 삭제 관련
pys: 파이썬 스크립트
kcp: 프로그램 기반
net: 네트워크 통신
fs: 파일시스템 관련
ui: User Interface관련
db: 데이터베이스 관련
update: Version 업데이트
doc: 문서 업데이트
```

---

# 콘솔 (Console)

`Koromo Copy`를 `Debug`모드로 실행하면 자동으로 `Console`이 실행됩니다. `Console`은 프로그램의 모든 IO를 캡쳐하며, 작업, 오류를 보여줍니다. 또한 미리 정의된 명령을 이용해 사용자 정의 작업을 수행할 수 있습니다. `Koromo Copy`는 하나의 `Console`만을 지원하며, 두 개 이상의 `Console`창을 열 수 없습니다.

## 콘솔 구조

`Koromo Copy`의 `Console`은 `CommandLineParser`를 가지고 있습니다. 이 파서는 사용자 입력을 분석하여 각 최상위 명령 클래스로 인자들을 보냅니다. 첫 번재 인자는 최상위 명령 클래스의 요소 이름이여야하며, 두 번째 부터 각 최상위 명령 클래스가 필요로하는 인자들을 포함해야합니다. 각 최상위 명령 클래스는 `--help` 인자를 기본으로 가집니다. 또한 하나의 파이프라인 명령을 포함하고 있습니다. 파이프라인 명령은 `>` 명령 하나이며, `A > B`와 같이 표현할 수 있습니다. `A > B` 명령어는 `A`의 Output을 `B`의 인자로 보내란 명령입니다. 또한 루프 파이프라인 명령 `|>`로 new line으로 구분된 다중 결과를 처리할 수 있습니다.

## Command Line Parser

`CommandLineParser`는 리다이렉션된 최상위 명령 클래스에서 사용됩니다. 각 최상위 명령 클래스는 옵션 클래스를 가지고있으며, `CommandLineParser`는 이 옵션 클래스를 이용해 명령어를 분석하게 됩니다.

콘솔에서 입력받은 사용자 명령은 다음과 같은 과정을 거쳐 처리됩니다.

```
Console입력 => 각 최상위 명령 클래스 => Command Line Parser(+ Option)
    => 명령어 실행 => 파이프라인 연결 ...
```

## 명령어

다음은 `Koromo Copy Console`에서 사용가능한 명령어를 정리한 것입니다. 모든 명령어는 특정 최상위 명령 클래스와 연결됩니다. 이 리다이렉션은 `Console.cs::Loop()` 함수의 `Dictionary`에 정의되어있습니다.

| 명령어 | 설명 |
| ------|-------|
|hitomi|히토미와 관련된 모든 명령을 포함합니다.|
|exh|익헨과 관련된 모든 명령을 포함합니다.|
|pixiv|픽시브와 관련된 모든 명령을 포함합니다.|
|grep|일반문자열이나 정규표현식으로 검색가능한 grep 도구입니다.|
|out|파일 쓰기에 관련한 명령을 포함합니다.|
|in|파일 읽기(텍스트 파일)를 위한 명령입니다.|
|scan|파일 열거에 관련한 명령을 포함합니다.|
|run|특정 유틸리티 실행 명령입니다.|
|down|입력받은 Url이나, 배열의 모든 요소를 입력받은 경로 규칙에 맞게 다운로드합니다. (추가예정)|

기본적으로 명령어의 규칙은 `옵션`, `인자`, `지정` 이렇게 세가지로 구성됩니다.

`옵션`은 `True`나 `False` 중 하나의 상태를 가지며, 커맨드라인에 `옵션`이 포함되면 해당 옵션을 `True`로 지정합니다. `Koromo Copy`에선 일반적으로 `-a`, `-b`, `-c` 처럼 `-`와 한 글자의 알파벳이 합쳐진 형태로 선언되어있습니다. 또한 일부 최상위 명령을 제외하면, 접두사로 `-`가 하나만 존재하는 경우엔 `옵션`으로 보며, `-abc`처럼 되어있으면, `-a -b -c`로 인식하는 최상위 명령어들이 존재합니다.

`인자`는 하나 이상의 인자를 필요로합니다. 일부 최상위 명령에는 `기본 인자`가 존재하며, `기본 인자`는 생략되어도, 필요한 인자가 존재한다면 자동으로 인식됩니다. 인자는 반드시 `인자`바로뒤에 와야하며, `-`나, `--`로 시작할 수 없습니다.

`지정`은 미리 정해진 옵션들 중 사용자가 선택할 수 있게끔 선택지를 제공합니다. `-type=small`, `-type="big"`처럼 쓰이며, `-`나 `--`옵션뒤에 `=`를 붙히고, 특정 옵션을 지정하면됩니다.

## hitomi 명령 예제

```
1. 특정 작품의 정보를 얻고 싶을 경우
hitomi -article 1234

2. 특정 작품의 이미지 정보를 얻고 싶을 경우
hitomi -image 1234

3. 특정 작품의 썸네일 정보를 얻고 싶을 경우
hitomi -image 1234 -type=small
hitomi -image 1234 -type=big

4. 메타데이터/히든데이터를 다운로드하고 싶을 경우
hitomi -downloadmetadata
hitomi -downloadhidden
* 히든데이터 다운로드는 단독으로 불가능하며, 메타데이터가 로드된 상태여야함

5. 메타데이터/히든데이터를 로드하고 싶을 경우
hitomi -loadmetadata
hitomi -loadhidden
hitomi -load
* 히든데이터 로드는 단독으로 불가능하며, 메타데이터가 로드된 상태여야함

6. 데이터를 동기화하고 싶을 경우
hitomi -sync

7. 검색하고 싶을 경우
hitomi -search "artist:hisasi lang:korean"

8. 자세한 검색결과를 얻고싶을 경우
hitomi -search "artist:hisasi lang:korean" -all

9. 특정 검색 토큰을 고정시키고 싶을 경우
hitomi -setsearch "lang:korean"
hitomi -search "artist:hisasi" -all
```

## exh 명령 예제

---

# 소스코드 구조

## 콘솔